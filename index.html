<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>حالة الطقس</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
</head>
<body>
  <main class="container">
    <h2>🌤️ حالة الطقس الآن عند موقعك</h2>
    <p id="result">⏳ جاري تحديد موقعك...</p>
  </main>

  <script>
    // ⚠️ ضع مفتاح OpenWeatherMap هنا بين علامتي التنصيص
    const apiKey = "d6755749bd44c8d99494a6fb8bcd52ee";

    function showWeather(lat, lon) {
      const url = https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&lang=ar&units=metric;

      console.log("جاري جلب الطقس من:", url); // ✅ للتأكد من الرابط

      fetch(url)
        .then(res => res.json())
        .then(data => {
          console.log("البيانات الراجعة:", data); // ✅ لعرض الرد

          if (data.weather) {
            const condition = data.weather[0].main.toLowerCase();
            let status = "";

            if (condition.includes("clear")) status = "☀️ مشمس";
            else if (condition.includes("cloud")) status = "☁️ غائم";
            else if (condition.includes("rain")) status = "🌧️ ممطر";
            else if (condition.includes("snow")) status = "❄️ مثلج";
            else status = "🙂 جيد";

            document.getElementById("result").innerText =
              الطقس في ${data.name}: ${status}, الحرارة ${data.main.temp}°C;
          } else {
            document.getElementById("result").innerText = "⚠️ لم أستطع جلب الطقس لموقعك";
          }
        })
        .catch(err => {
          console.error("خطأ في الاتصال بالـ API:", err);
          document.getElementById("result").innerText = "🚨 حدث خطأ أثناء الاتصال بالخدمة";
        });
    }

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        pos => {
          console.log("تم تحديد الموقع:", pos.coords); // ✅ اختبار
          showWeather(pos.coords.latitude, pos.coords.longitude);
        },
        err => {
          console.error("خطأ في تحديد الموقع:", err);
          document.getElementById("result").innerText = "⚠️ لم أستطع تحديد موقعك";
        }
      );
    } else {
      document.getElementById("result").innerText = "🚫 المتصفح لا يدعم تحديد الموقع";
    }
  </script>
</body>
</html>
